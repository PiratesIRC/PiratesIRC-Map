<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' https://fonts.googleapis.com; font-src https://fonts.gstatic.com; img-src 'self' data:; connect-src 'self';">
	<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Interactive Map</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IM+Fell+English&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="sidebar">

        <div class="sidebar-tabs">
            <button class="tab-btn active" data-tab="ports">Ports</button>
            <button class="tab-btn" data-tab="entities">Entities</button>
        </div>

        <!-- Search Box -->
        <div class="search-container">
            <input type="text" id="search-box" placeholder="Search ports/entities..." autocomplete="off">
            <button id="clear-search" class="clear-search-btn" style="display: none;">√ó</button>
        </div>

        <p class="last-updated">Last Updated: 10/26/2025</p>

        <div class="tab-content active" id="ports-content">
            <div class="port-list" id="port-list">
                </div>
        </div>

        <div class="tab-content" id="entities-content">
            <div class="port-list" id="entity-list">
                </div>
        </div>

    </div>

    <div class="map-viewport" id="map-viewport">
        <div class="map-container" id="map-container">
            <img src="images/map.jpg" alt="Map of the Caribbean">

            <div class="map-tooltip" id="map-tooltip"></div>
            <div class="coordinate-tooltip" id="coordinate-tooltip"></div>
        </div>

        <!-- Zoom Slider -->
        <div class="zoom-slider-container">
            <div class="zoom-slider-label">+</div>
            <input type="range" id="zoom-slider" class="zoom-slider" min="0.25" max="5" step="0.05" value="0.29" orient="vertical">
            <div class="zoom-slider-label">-</div>
        </div>

        <!-- Mini Map -->
        <div class="mini-map" id="mini-map">
            <canvas id="mini-map-canvas" width="150" height="98"></canvas>
            <div class="mini-map-viewport" id="mini-map-viewport"></div>
        </div>

        <!-- Help Button -->
        <button class="help-button" id="help-button" title="Help & Shortcuts">?</button>

        <!-- Help Modal -->
        <div class="help-modal" id="help-modal" style="display: none;">
            <div class="help-modal-content">
                <button class="help-modal-close" id="help-modal-close">√ó</button>
                <h2>Map Controls & Guide</h2>

                <div class="help-section">
                    <h3>Keyboard Shortcuts</h3>
                    <div class="help-shortcuts">
                        <div><kbd>‚Üë ‚Üì ‚Üê ‚Üí</kbd> Pan the map</div>
                        <div><kbd>+ / =</kbd> Zoom in</div>
                        <div><kbd>- / _</kbd> Zoom out</div>
                        <div><kbd>ESC</kbd> Close tooltips</div>
                    </div>
                </div>

                <div class="help-section">
                    <h3>Mouse Controls</h3>
                    <div class="help-shortcuts">
                        <div>Click marker to center view</div>
                        <div>Double-click map to zoom in</div>
                        <div>Scroll wheel to zoom</div>
                        <div>Drag to pan</div>
                    </div>
                </div>

                <div class="help-section">
                    <h3>Copy Coordinates</h3>
                    <p>Click the üìã button in tooltips to copy coordinates to clipboard.</p>
                </div>

                <div class="help-section">
                    <h3>Faction Colors</h3>
                    <div class="help-legend">
                        <div class="legend-item"><span class="legend-color spanish"></span> Spanish</div>
                        <div class="legend-item"><span class="legend-color english"></span> English</div>
                        <div class="legend-item"><span class="legend-color french"></span> French</div>
                        <div class="legend-item"><span class="legend-color dutch"></span> Dutch</div>
                        <div class="legend-item"><span class="legend-color pirate"></span> Pirate</div>
                        <div class="legend-item"><span class="legend-color native"></span> Native</div>
                        <div class="legend-item"><span class="legend-color jesuit"></span> Jesuit</div>
                        <div class="legend-item"><span class="legend-color infected"></span> Infected</div>
                        <div class="legend-item"><span class="legend-color independent"></span> Independent</div>
                    </div>
                </div>

                <div class="help-section">
                    <h3>Terrain Colors</h3>
                    <div class="help-legend">
                        <div class="legend-item"><span class="legend-color terrain-land"></span> Land</div>
                        <div class="legend-item"><span class="legend-color terrain-water"></span> Water</div>
                        <div class="legend-item"><span class="legend-color terrain-both"></span> Coastal</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="map-toolbar">
            <!-- Collapse/Expand Buttons -->
            <button class="toolbar-collapse-btn" id="toolbar-collapse-btn" title="Collapse toolbar">‚ñº</button>
            <button class="toolbar-expand-btn" id="toolbar-expand-btn" title="Expand toolbar">‚ñ≤</button>

            <!-- Reset Button -->
            <div class="toolbar-section">
                <button class="reset-btn" id="reset-view-btn" title="Reset View (Home)">‚åÇ</button>
            </div>

            <!-- Navigation Controls -->
            <div class="toolbar-section">
                <div class="toolbar-label">‚äï Nav</div>
                <div class="pan-controls">
                    <button class="pan-btn" id="pan-up-btn" title="Pan Up (‚Üë)">&#8593;</button>
                    <div>
                        <button class="pan-btn" id="pan-left-btn" title="Pan Left (‚Üê)">&#8592;</button>
                        <button class="pan-btn" id="pan-right-btn" title="Pan Right (‚Üí)">&#8594;</button>
                    </div>
                    <button class="pan-btn" id="pan-down-btn" title="Pan Down (‚Üì)">&#8595;</button>
                </div>
            </div>

            <!-- Zoom Controls -->
            <div class="toolbar-section">
                <div class="toolbar-label">üîç Zoom</div>
                <div class="zoom-controls">
                    <div class="zoom-level-display" id="zoom-level-display">1.0x</div>
                    <button class="zoom-btn" id="zoom-in-btn" title="Zoom In (+)">+</button>
                    <button class="zoom-btn" id="zoom-out-btn" title="Zoom Out (-)">-</button>
                </div>
            </div>

            <!-- Current Location Display -->
            <div class="toolbar-section">
                <div class="toolbar-label">üìç Location</div>
                <div class="current-location" id="current-location" title="Current viewport center">
                    <div class="location-grid" id="location-grid">A1</div>
                    <div class="location-coords" id="location-coords">20.0¬∞N, 80.0¬∞W</div>
                </div>
            </div>

            <!-- Loading Indicator -->
            <div class="toolbar-section">
                <div class="loading-indicator" id="loading-indicator" style="display: none;" title="Updating data...">
                    <div class="loading-spinner"></div>
                </div>
            </div>

            <!-- Display Toggles -->
            <div class="toolbar-section">
                <div class="toolbar-label">üëÅÔ∏è Display</div>
                <div class="toggle-controls">
                    <label class="toggle-item" title="Show/hide ports">
                        <input type="checkbox" id="toggle-ports" checked>
                        <span>Ports</span>
                    </label>
                    <label class="toggle-item" title="Show/hide entities">
                        <input type="checkbox" id="toggle-entities" checked>
                        <span>Entities</span>
                    </label>
                    <label class="toggle-item" title="Show/hide grid">
                        <input type="checkbox" id="toggle-gridlines" checked>
                        <span>Grid</span>
                    </label>
                    <label class="toggle-item" title="Show/hide terrain overlay">
                        <input type="checkbox" id="toggle-terrain">
                        <span>Terrain</span>
                    </label>
                </div>
            </div>
        </div>
    </div>

    <script src="security-utils.js"></script>
    <script src="script.js?v=205"></script>
</body>
</html>